##
## Copyright 2008 The qDecoder Project. All rights reserved.
##
## Redistribution and use in source and binary forms, with or without
## modification, are permitted provided that the following conditions
## are met:
##
## 1. Redistributions of source code must retain the above copyright
##    notice, this list of conditions and the following disclaimer.
## 2. Redistributions in binary form must reproduce the above copyright
##    notice, this list of conditions and the following disclaimer in the
##    documentation and/or other materials provided with the distribution.
##
## THIS SOFTWARE IS PROVIDED BY THE QDECODER PROJECT ``AS IS'' AND ANY
## EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
## WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
## DISCLAIMED. IN NO EVENT SHALL THE QDECODER PROJECT BE LIABLE FOR ANY
## DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
## (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
## LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
## ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
## (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
## THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
##

prefix		= @prefix@
exec_prefix	= ${prefix}

## Compiler options
CC	= @CC@
CFLAGS	= @CFLAGS@
DEFS	= @DEFS@ @OPT_DEFS@
INCLUDE	= -I. -I@includedir@
LIB	= @libdir@/libqDecoder.a -lpthread

TARGETS	= query.cgi cookie.cgi multivalue.cgi upload.cgi uploadfile.cgi download.cgi streamedit.cgi session.cgi config.cgi socket.cgi obstack.cgi \
	hashtable

## Main
all:	${TARGETS}

query.cgi: query.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

cookie.cgi: cookie.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

multivalue.cgi:	multivalue.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

upload.cgi: upload.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}
	chmod 6755 upload.cgi

uploadfile.cgi: uploadfile.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}
	chmod 6755 uploadfile.cgi
	mkdir -p -m 755 upload tmp

download.cgi: download.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

streamedit.cgi: streamedit.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

session.cgi: session.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}
	chmod 6755 session.cgi

config.cgi: config.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

socket.cgi: socket.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

obstack.cgi: obstack.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

hashtable: hashtable.o
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -o $@ $< ${LIB}

## Clear Module
clean:
	rm -f *.o ${TARGETS}
	rm -rf upload tmp

## Compile Module
.c.o:
	${CC} ${CFLAGS} ${DEFS} ${INCLUDE} -c -o $@ $<
